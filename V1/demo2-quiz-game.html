<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èª²å ‚å•ç­”æŒ‘æˆ°</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b0e1a;
    --card: #141829;
    --green: #00e676;
    --red: #ff5252;
    --blue: #448aff;
    --purple: #7c4dff;
    --orange: #ffab40;
    --yellow: #ffd740;
    --text: #f0f0f0;
    --text-dim: #6b7394;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Noto Sans TC', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }
  .app { max-width: 750px; margin: 0 auto; padding: 24px 18px; }

  /* === SETUP SCREEN === */
  .screen { display: none; }
  .screen.active { display: block; }

  .setup-header {
    text-align: center;
    margin-bottom: 32px;
    padding-top: 20px;
  }
  .setup-header h1 {
    font-family: 'Baloo 2', 'Noto Sans TC', sans-serif;
    font-size: 2.6rem;
    background: linear-gradient(135deg, var(--yellow), var(--orange), var(--red));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .setup-header p { color: var(--text-dim); margin-top: 6px; }

  .setup-card {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    border: 1px solid rgba(255,255,255,0.05);
  }
  .setup-card h3 { margin-bottom: 14px; font-size: 1.05rem; }
  .setup-card textarea {
    width: 100%;
    min-height: 220px;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    color: var(--text);
    padding: 14px;
    font-size: 0.92rem;
    font-family: 'Noto Sans TC', monospace;
    resize: vertical;
    line-height: 1.6;
  }
  .setup-card textarea:focus { outline: none; border-color: var(--blue); }
  .hint { color: var(--text-dim); font-size: 0.8rem; margin-top: 8px; line-height: 1.5; }

  .btn {
    font-family: inherit;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    padding: 14px 36px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: transform 0.12s, box-shadow 0.2s;
  }
  .btn:active { transform: scale(0.96); }
  .btn-start {
    background: linear-gradient(135deg, var(--blue), var(--purple));
    color: #fff;
    box-shadow: 0 4px 20px rgba(68,138,255,0.35);
    display: block;
    width: 100%;
    margin-top: 8px;
  }

  /* === QUIZ SCREEN === */
  .quiz-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .progress-text { color: var(--text-dim); font-size: 0.9rem; }
  .score-display {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.4rem;
    color: var(--yellow);
  }
  .progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.08);
    border-radius: 3px;
    margin-bottom: 28px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--blue), var(--purple));
    border-radius: 3px;
    transition: width 0.4s ease;
  }

  .timer-bar {
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px;
    margin-bottom: 24px;
    overflow: hidden;
  }
  .timer-fill {
    height: 100%;
    background: var(--green);
    border-radius: 2px;
    transition: width 0.1s linear, background 0.3s;
    width: 100%;
  }
  .timer-fill.warning { background: var(--orange); }
  .timer-fill.danger { background: var(--red); }

  .question-card {
    background: var(--card);
    border-radius: 20px;
    padding: 32px 28px;
    margin-bottom: 24px;
    border: 1px solid rgba(255,255,255,0.06);
    text-align: center;
  }
  .question-text {
    font-size: 1.45rem;
    font-weight: 700;
    line-height: 1.5;
  }

  .options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .option-btn {
    background: var(--card);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 14px;
    padding: 18px 16px;
    color: var(--text);
    font-size: 1.05rem;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .option-btn:hover:not(.disabled) {
    border-color: var(--blue);
    background: rgba(68,138,255,0.08);
    transform: translateY(-2px);
  }
  .option-btn .label {
    position: absolute;
    top: 8px;
    left: 12px;
    font-size: 0.75rem;
    color: var(--text-dim);
    font-weight: 400;
  }
  .option-btn.correct {
    border-color: var(--green);
    background: rgba(0,230,118,0.12);
    color: var(--green);
  }
  .option-btn.wrong {
    border-color: var(--red);
    background: rgba(255,82,82,0.1);
    color: var(--red);
  }
  .option-btn.disabled { pointer-events: none; }
  .option-btn.dim { opacity: 0.4; }

  .feedback {
    text-align: center;
    margin-top: 20px;
    font-size: 1.1rem;
    font-weight: 700;
    min-height: 40px;
  }
  .feedback.correct-fb { color: var(--green); }
  .feedback.wrong-fb { color: var(--red); }

  /* === RESULT SCREEN === */
  .result-center { text-align: center; padding-top: 40px; }
  .result-emoji { font-size: 5rem; margin-bottom: 16px; }
  .result-title {
    font-family: 'Baloo 2', sans-serif;
    font-size: 2.2rem;
    margin-bottom: 8px;
  }
  .result-score {
    font-size: 3.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, var(--yellow), var(--orange));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 16px 0;
  }
  .result-detail { color: var(--text-dim); font-size: 1rem; margin-bottom: 30px; }
  .result-bars { max-width: 400px; margin: 0 auto 30px; }
  .result-bar-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
    font-size: 0.92rem;
  }
  .result-bar-label { width: 50px; text-align: right; color: var(--text-dim); }
  .result-bar-track {
    flex: 1;
    height: 10px;
    background: rgba(255,255,255,0.06);
    border-radius: 5px;
    overflow: hidden;
  }
  .result-bar-fill {
    height: 100%;
    border-radius: 5px;
    transition: width 1s ease;
  }

  .btn-again {
    background: linear-gradient(135deg, var(--purple), var(--blue));
    color: #fff;
    box-shadow: 0 4px 20px rgba(124,77,255,0.3);
  }

  @media (max-width: 550px) {
    .options { grid-template-columns: 1fr; }
    .question-text { font-size: 1.2rem; }
    .setup-header h1 { font-size: 2rem; }
  }
</style>
</head>
<body>

<div class="app">
  <!-- SETUP -->
  <div class="screen active" id="setupScreen">
    <a href="index.html" style="display:inline-block;color:var(--text-dim);text-decoration:none;font-size:0.9rem;margin-bottom:12px;transition:color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='var(--text-dim)'">â† è¿”å›é¦–é </a>
    <div class="setup-header">
      <h1>ğŸ§  èª²å ‚å•ç­”æŒ‘æˆ°</h1>
      <p>è‡ªè¨‚é¡Œç›®ï¼Œå³æ™‚æŒ‘æˆ°ï¼</p>
    </div>
    <div class="setup-card">
      <h3>ğŸ“ è¼¸å…¥é¡Œç›®ï¼ˆJSON æ ¼å¼ï¼‰</h3>
      <textarea id="quizInput">[
  {
    "q": "å°ç£æœ€é«˜çš„å±±æ˜¯å“ªä¸€åº§ï¼Ÿ",
    "options": ["é˜¿é‡Œå±±", "ç‰å±±", "é›ªå±±", "åˆæ­¡å±±"],
    "answer": 1
  },
  {
    "q": "æ°´çš„åŒ–å­¸å¼æ˜¯ä»€éº¼ï¼Ÿ",
    "options": ["CO2", "H2O", "O2", "NaCl"],
    "answer": 1
  },
  {
    "q": "ã€Œä¸‰åœ‹æ¼”ç¾©ã€çš„ä½œè€…æ˜¯èª°ï¼Ÿ",
    "options": ["æ›¹é›ªèŠ¹", "å³æ‰¿æ©", "æ–½è€åºµ", "ç¾…è²«ä¸­"],
    "answer": 3
  },
  {
    "q": "å…‰çš„ä¸‰åŸè‰²æ˜¯ï¼Ÿ",
    "options": ["ç´…ã€é»ƒã€è—", "ç´…ã€ç¶ ã€è—", "ç´…ã€ç¶ ã€é»ƒ", "ç´…ã€è—ã€ç´«"],
    "answer": 1
  },
  {
    "q": "1 å…¬é‡Œç­‰æ–¼å¹¾å…¬å°ºï¼Ÿ",
    "options": ["100", "500", "1000", "10000"],
    "answer": 2
  }
]</textarea>
      <div class="hint">answer å€¼ç‚ºé¸é …ç´¢å¼•ï¼ˆå¾ 0 é–‹å§‹ï¼‰ã€‚ä½ å¯ä»¥è«‹ AI å¹«ä½ ç”¢ç”Ÿä»»ä½•ç§‘ç›®çš„é¡Œç›®ï¼</div>
    </div>
    <button class="btn btn-start" onclick="startQuiz()">ğŸš€ é–‹å§‹æŒ‘æˆ°</button>
  </div>

  <!-- QUIZ -->
  <div class="screen" id="quizScreen">
    <div class="quiz-top">
      <span class="progress-text" id="progressText">ç¬¬ 1 / 5 é¡Œ</span>
      <span class="score-display" id="scoreDisplay">â­ 0</span>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
    <div class="question-card">
      <div class="question-text" id="questionText"></div>
    </div>
    <div class="options" id="optionsContainer"></div>
    <div class="feedback" id="feedback"></div>
  </div>

  <!-- RESULT -->
  <div class="screen" id="resultScreen">
    <div class="result-center">
      <div class="result-emoji" id="resultEmoji"></div>
      <div class="result-title" id="resultTitle"></div>
      <div class="result-score" id="resultScore"></div>
      <div class="result-detail" id="resultDetail"></div>
      <div class="result-bars" id="resultBars"></div>
      <button class="btn btn-again" onclick="goSetup()">ğŸ” å†ç©ä¸€æ¬¡</button>
    </div>
  </div>
</div>

<script>
  let questions = [];
  let current = 0;
  let score = 0;
  let timer = null;
  let timeLeft = 0;
  const TIME_LIMIT = 15; // seconds per question

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // localStorage persistence
  const STORAGE_KEY = 'quiz_questions';
  function saveQuiz() {
    localStorage.setItem(STORAGE_KEY, document.getElementById('quizInput').value);
  }
  function loadQuiz() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved !== null) document.getElementById('quizInput').value = saved;
  }
  loadQuiz();
  document.getElementById('quizInput').addEventListener('input', saveQuiz);

  function startQuiz() {
    try {
      questions = JSON.parse(document.getElementById('quizInput').value);
      if (!Array.isArray(questions) || questions.length === 0) throw new Error();
    } catch {
      alert('é¡Œç›®æ ¼å¼æœ‰èª¤ï¼Œè«‹æª¢æŸ¥ JSON æ ¼å¼ï¼');
      return;
    }
    current = 0;
    score = 0;
    showScreen('quizScreen');
    showQuestion();
  }

  function showQuestion() {
    const q = questions[current];
    const labels = ['A', 'B', 'C', 'D'];
    document.getElementById('progressText').textContent = `ç¬¬ ${current + 1} / ${questions.length} é¡Œ`;
    document.getElementById('scoreDisplay').textContent = `â­ ${score}`;
    document.getElementById('progressFill').style.width = `${((current) / questions.length) * 100}%`;
    document.getElementById('questionText').textContent = q.q;
    document.getElementById('feedback').textContent = '';
    document.getElementById('feedback').className = 'feedback';

    const container = document.getElementById('optionsContainer');
    container.innerHTML = '';
    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.innerHTML = `<span class="label">${labels[i]}</span>${opt}`;
      btn.onclick = () => selectAnswer(i);
      container.appendChild(btn);
    });

    // Start timer
    timeLeft = TIME_LIMIT;
    const timerFill = document.getElementById('timerFill');
    timerFill.style.width = '100%';
    timerFill.className = 'timer-fill';
    clearInterval(timer);
    timer = setInterval(() => {
      timeLeft -= 0.1;
      const pct = (timeLeft / TIME_LIMIT) * 100;
      timerFill.style.width = pct + '%';
      if (pct < 30) timerFill.className = 'timer-fill danger';
      else if (pct < 60) timerFill.className = 'timer-fill warning';

      if (timeLeft <= 0) {
        clearInterval(timer);
        selectAnswer(-1); // timeout
      }
    }, 100);
  }

  function selectAnswer(idx) {
    clearInterval(timer);
    const q = questions[current];
    const btns = document.querySelectorAll('.option-btn');
    const feedback = document.getElementById('feedback');

    btns.forEach((b, i) => {
      b.classList.add('disabled');
      if (i === q.answer) b.classList.add('correct');
      if (i === idx && idx !== q.answer) b.classList.add('wrong');
      if (i !== q.answer && i !== idx) b.classList.add('dim');
    });

    if (idx === q.answer) {
      score++;
      feedback.textContent = 'âœ… ç­”å°äº†ï¼å¤ªå²å®³äº†ï¼';
      feedback.className = 'feedback correct-fb';
      document.getElementById('scoreDisplay').textContent = `â­ ${score}`;
    } else if (idx === -1) {
      feedback.textContent = `â° æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${q.options[q.answer]}ã€`;
      feedback.className = 'feedback wrong-fb';
    } else {
      feedback.textContent = `âŒ å¯æƒœï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${q.options[q.answer]}ã€`;
      feedback.className = 'feedback wrong-fb';
    }

    setTimeout(() => {
      current++;
      if (current < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }, 2000);
  }

  function showResult() {
    showScreen('resultScreen');
    const pct = Math.round((score / questions.length) * 100);
    let emoji, title;
    if (pct === 100) { emoji = 'ğŸ†'; title = 'å®Œç¾æ»¿åˆ†ï¼'; }
    else if (pct >= 80) { emoji = 'ğŸŒŸ'; title = 'éå¸¸å„ªç§€ï¼'; }
    else if (pct >= 60) { emoji = 'ğŸ‘'; title = 'è¡¨ç¾ä¸éŒ¯ï¼'; }
    else if (pct >= 40) { emoji = 'ğŸ’ª'; title = 'ç¹¼çºŒåŠ æ²¹ï¼'; }
    else { emoji = 'ğŸ“š'; title = 'å†è¤‡ç¿’ä¸€ä¸‹å§ï¼'; }

    document.getElementById('resultEmoji').textContent = emoji;
    document.getElementById('resultTitle').textContent = title;
    document.getElementById('resultScore').textContent = `${score} / ${questions.length}`;
    document.getElementById('resultDetail').textContent = `æ­£ç¢ºç‡ ${pct}%`;

    const bars = document.getElementById('resultBars');
    bars.innerHTML = `
      <div class="result-bar-row">
        <span class="result-bar-label" style="color:var(--green)">ç­”å°</span>
        <div class="result-bar-track">
          <div class="result-bar-fill" style="width:0%;background:var(--green);" id="correctBar"></div>
        </div>
        <span>${score}</span>
      </div>
      <div class="result-bar-row">
        <span class="result-bar-label" style="color:var(--red)">ç­”éŒ¯</span>
        <div class="result-bar-track">
          <div class="result-bar-fill" style="width:0%;background:var(--red);" id="wrongBar"></div>
        </div>
        <span>${questions.length - score}</span>
      </div>
    `;
    setTimeout(() => {
      document.getElementById('correctBar').style.width = `${(score/questions.length)*100}%`;
      document.getElementById('wrongBar').style.width = `${((questions.length-score)/questions.length)*100}%`;
    }, 100);
  }

  function goSetup() {
    showScreen('setupScreen');
  }
</script>
</body>
</html>
